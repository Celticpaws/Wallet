<html>
<head>
    {% load static %}
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script src="https://code.highcharts.com/highcharts.src.js"></script>
    <link rel="stylesheet" type="text/css" href="{% static 'css/style-blue.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
       
</head>
   
<body>
    <div class="container">
        <nav class="blue">
            <div class="nav-wrapper">
              <ul id="nav-mobile" class="right hide-on-med-and-down">
                <li><a href="/">Home</a></li>
                <li><a href="/incomes">Incomes</a></li>
                <li><a href="/outcomes">Outcomes</a></li>
                <li><a href="/transfers">Transfers</a></li>
                <li class="active"><a href="/budgets">Budgets</a></li>
              </ul>
            </div>
          </nav>
        <div class="col-lg-12">       
        <div class="col-sm-6"><h2>Budgets</h2></div>
        <div class="col-sm-1 col-sm-offset-5" style="padding-top: 3%;"><a class="btn-floating btn-large waves-effect waves-light blue"><i class="material-icons">+</i></a></div>
        </div>    
            <ul class="nav nav-tabs">
              {% for month in months %}
              <li><a data-toggle="tab" href="#menu{{forloop.counter}}">{{month}}</a></li>
              {%endfor%}
            </ul>
            <br>
            <div class="tab-content">      
            {% for start,end,table,income in tables %}

              <div id="menu{{forloop.counter}}" class="tab-pane fade">
                    <div class="col-lg-12" style="padding-bottom:3%">
                        <div class="info col-sm-1">Inicio</div>
                        <div class="info2 col-sm-3">{{start}}</div>
                        <div class="info col-sm-1">Fin</div>

                        <div class="info2 col-sm-3">{{end}}</div>
                        <div class="info col-sm-1">Hoy</div>
                        <div class="info2 col-sm-3">{{today|date:"d \d\e F \d\e Y"}}</div>
                    </div>
                    <div class="col-lg-12">
                        <div id="circle{{forloop.counter}}" class="col-sm-6"></div>
                        <div id="line{{forloop.counter}}" class="col-sm-6"></div>
                    </div>
                    <div class="col-lg-12">
                        <div class="col-sm-12">
                                <table class="accountstable">
                                    <tr>
                                        <th> Categoria </th>
                                        <th> Monto </th>
                                        <th> % </th>
                                        <th> Restante </th>
                                        <th> Gastado </th>
                                        <th> Barra </th>
                                    </tr>
                                    {%for values in table%}
                                        <tr>
                                            <td> {{values.category}}</td>
                                            <td style="text-align:center"> {{values.date|date:"d-m-Y"}}</td>
                                            <td> {{values.amount}}  €</td>
                                            <td> {{values.amount}} </td>
                                            <td style="text-align:center"> {% widthratio values.amount income 1 %} </td>
                                        </tr>
                                    {%endfor%}
                                </table>
                                <div class="info col-sm-6 col-sm-offset-3">Gastos: {{total}} €</div>
                            </div>
                    </div>
                    <div class="col-lg-12">
                    </div>
                    <script>
                        var pieColors = (function () {
                            var colors = [],base = '#b50000',i;
                            for (i = 0; i < 25; i += 1) {colors.push(Highcharts.Color(base).brighten((i - 5) / 25).get());}
                            return colors;}()); 
                        var colors = pieColors,
                        categories = [{%for c in categories %}"{{c.name}}",{%endfor%}],
                        data = [{% for circle in circles %}{"y": {{circle.0}},"color": colors[{{forloop.counter}}],
                                    "drilldown": {"name": "{{circle.1}}",
                                        "categories":[{% for c in circle.2 %}"{{c}}",{% endfor %}],
                                        "data": [{% for c in circle.3 %}{{c}},{% endfor %}],}},{% endfor %}],
                        browserData = [],versionsData = [],i,j,dataLen = data.length,drillDataLen,brightness;
                        for (i = 0; i < dataLen; i += 1) {browserData.push({name: categories[i],y: data[i].y,color: data[i].color});
                        drillDataLen = data[i].drilldown.data.length;
                        for (j = 0; j < drillDataLen; j += 1) {brightness = 0.2 - (j / drillDataLen) / 5;
                            versionsData.push({name: data[i].drilldown.categories[j],y: data[i].drilldown.data[j],color: Highcharts.Color(data[i].color).brighten(brightness).get()});}}
                        Highcharts.chart('circle{{forloop.counter}}', {
                        chart: {type: 'pie'},title: {text: ''},subtitle: {text: ''},yAxis: {title: {text: ''}},
                        plotOptions: {pie: {shadow: false,center: ['50%', '50%']}},tooltip: {valueSuffix: '%'},
                        series: [{name: 'Total',data: browserData,size: '60%',dataLabels: {
                            formatter: function () {return this.y > 5 ? this.point.name : null;},color: '#ffffff',distance: -30}
                        }, {name: 'SubTotal',data: versionsData,size: '95%',innerSize: '70%',dataLabels: {
                            formatter: function () {return this.y > 1 ? '<b>' + this.point.name + ':</b> ' +this.y + '%' : null;}},id: 'versions'}],
                        responsive: {rules: [{condition: {maxWidth: 400},
                            chartOptions: {series: [{id: 'versions',dataLabels: {enabled: false}}]}}]}});
                    </script>
                    <script>
                            Highcharts.chart('line{{forloop.counter}}', {
                                chart: {
                                  type: 'areaspline'
                                },
                                title: {
                                  text: ''
                                },
                                legend: {
                                  layout: 'vertical',
                                  align: 'left',
                                  verticalAlign: 'top',
                                  x: 150,
                                  y: 100,
                                  floating: true,
                                  borderWidth: 1,
                                  backgroundColor: (Highcharts.theme && Highcharts.theme.legendBackgroundColor) || '#FFFFFF'
                                },
                                xAxis: {
                                  categories: [{%for day in days%}'{{day}}',{%endfor%}],
                                },
                                yAxis: {
                                  title: {
                                    text: ''
                                  }
                                },
                                tooltip: {
                                  shared: true,
                                  valueSuffix: ' €'
                                },
                                credits: {
                                  enabled: false
                                },
                                plotOptions: {
                                  areaspline: {
                                    fillOpacity: 0.3
                                  }
                                },
                                colors: ['#b50000','#660000','#2f0000'],
                                series: [
                                    {% for line in seriesline %}{
                                  name: "{{line.0}}",
                                  data: [{%for i in line.1%}{{i}},{%endfor%}]
                                },{%endfor%}]
                              });
                    </script>
              </div>
            {%endfor%}
            </div>
        </div>
          

    


</body>
</html>